<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Maps API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        
        .test-container {
            border: 2px solid #007bff;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .pac-container {
            background-color: white !important;
            z-index: 9999999 !important;
            border: 2px solid #007bff !important;
            border-radius: 8px !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15) !important;
            margin-top: 4px !important;
            font-family: inherit !important;
            pointer-events: auto !important;
            position: absolute !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            width: auto !important;
            min-width: 300px !important;
        }
        
        .pac-item {
            padding: 12px 16px !important;
            cursor: pointer !important;
            border-bottom: 1px solid #EBEBEB !important;
            font-size: 14px !important;
        }
        
        .pac-item:hover {
            background: #f0f8ff !important;
        }
        
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
    </style>
</head>
<body>
    <h1>üó∫Ô∏è Google Maps API Test</h1>
    
    <div class="test-container">
        <h2>Address Autocomplete Test</h2>
        <p><strong>Instructions:</strong> Type an address like "141 Chartland" and see if suggestions appear.</p>
        
        <label for="address-input">Street Address:</label>
        <input type="text" id="address-input" placeholder="Start typing an address...">
        
        <div id="address-result" class="result" style="display: none;">
            <h4>Selected Address Details:</h4>
            <div id="address-details"></div>
        </div>
    </div>
    
    <div class="test-container">
        <h2>City Autocomplete Test</h2>
        <p><strong>Instructions:</strong> Type a city name like "Toronto" and see if suggestions appear.</p>
        
        <label for="city-input">City:</label>
        <input type="text" id="city-input" placeholder="Start typing a city name...">
        
        <div id="city-result" class="result" style="display: none;">
            <h4>Selected City Details:</h4>
            <div id="city-details"></div>
        </div>
    </div>
    
    <div class="test-container">
        <h2>API Status</h2>
        <div id="api-status" class="result">Checking Google Maps API...</div>
    </div>

    <!-- Google Maps API -->
    <script async defer 
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCPhhp2rAt1VTrIzjgagJXZPZ_nc7K_BVo&libraries=places&callback=initMap">
    </script>

    <script>
        let addressAutocomplete;
        let cityAutocomplete;
        
        function initMap() {
            console.log('üéâ Google Maps API loaded successfully!');
            
            const statusDiv = document.getElementById('api-status');
            statusDiv.className = 'result success';
            statusDiv.innerHTML = '‚úÖ Google Maps API loaded successfully!<br>üìç Places library available: ' + (!!window.google?.maps?.places);
            
            // Initialize address autocomplete
            const addressInput = document.getElementById('address-input');
            if (window.google && window.google.maps && window.google.maps.places) {
                try {
                    addressAutocomplete = new window.google.maps.places.Autocomplete(addressInput, {
                        types: ['address'],
                        componentRestrictions: { country: 'ca' }
                    });
                    
                    addressAutocomplete.addListener('place_changed', function() {
                        const place = addressAutocomplete.getPlace();
                        console.log('Address selected:', place);
                        
                        if (place.address_components) {
            const comps = place.address_components;
            const pick = (type) => comps.find(c => c.types.includes(type))?.long_name || '';
            
            const streetNumber = pick('street_number');
            const route = pick('route');
            const fullAddress = streetNumber && route ? `${streetNumber} ${route}` : place.formatted_address;
            
            const details = {
                'Full Address': fullAddress,
                'Street Number': pick('street_number'),
                'Route': pick('route'),
                'City': pick('locality') || pick('sublocality'),
                'Province': pick('administrative_area_level_1'),
                'Postal Code': pick('postal_code'),
                'Country': pick('country'),
                'Latitude': place.geometry?.location?.lat(),
                'Longitude': place.geometry?.location?.lng()
            };
            
            let html = '';
            for (const [key, value] of Object.entries(details)) {
                html += `<strong>${key}:</strong> ${value || 'N/A'}<br>`;
            }
            
            document.getElementById('address-details').innerHTML = html;
            document.getElementById('address-result').style.display = 'block';
            
            // Send data to parent React app
            const locationData = {
                address: fullAddress || '',
                city: pick('locality') || pick('sublocality') || '',
                province: pick('administrative_area_level_1') || '',
                postalCode: pick('postal_code') || '',
                country: pick('country') || 'Canada',
                latitude: place.geometry?.location?.lat() || null,
                longitude: place.geometry?.location?.lng() || null
            };
            
            if (window.parent) {
                window.parent.postMessage({
                    type: 'LOCATION_UPDATE',
                    data: locationData
                }, '*');
            }
        }
                    });
                    
                    console.log('‚úÖ Address autocomplete initialized');
                } catch (error) {
                    console.error('‚ùå Error initializing address autocomplete:', error);
                    statusDiv.className = 'result error';
                    statusDiv.innerHTML = '‚ùå Error initializing address autocomplete: ' + error.message;
                }
                
                // Initialize city autocomplete
                const cityInput = document.getElementById('city-input');
                try {
                    cityAutocomplete = new window.google.maps.places.Autocomplete(cityInput, {
                        types: ['(cities)'],
                        componentRestrictions: { country: 'ca' }
                    });
                    
                    cityAutocomplete.addListener('place_changed', function() {
                        const place = cityAutocomplete.getPlace();
                        console.log('City selected:', place);
                        
                        if (place.address_components) {
                            const comps = place.address_components;
                            const pick = (type) => comps.find(c => c.types.includes(type))?.long_name || '';
                            
                            const details = {
                                'Place Name': place.name,
                                'Formatted Address': place.formatted_address,
                                'City': pick('locality') || pick('postal_town'),
                                'Province': pick('administrative_area_level_1'),
                                'Country': pick('country'),
                                'Place ID': place.place_id,
                                'Types': place.types?.join(', ')
                            };
                            
                            let html = '';
                            for (const [key, value] of Object.entries(details)) {
                                html += `<strong>${key}:</strong> ${value || 'N/A'}<br>`;
                            }
                            
                            document.getElementById('city-details').innerHTML = html;
                            document.getElementById('city-result').style.display = 'block';
                        }
                    });
                    
                    console.log('‚úÖ City autocomplete initialized');
                } catch (error) {
                    console.error('‚ùå Error initializing city autocomplete:', error);
                }
            } else {
                statusDiv.className = 'result error';
                statusDiv.innerHTML = '‚ùå Google Maps Places library not available';
            }
        }
        
        // Fallback if callback doesn't work
        window.addEventListener('load', function() {
            setTimeout(function() {
                if (!window.google) {
                    const statusDiv = document.getElementById('api-status');
                    statusDiv.className = 'result error';
                    statusDiv.innerHTML = '‚ùå Google Maps API failed to load. Check your API key and internet connection.';
                }
            }, 3000);
        });
        
        // Debug info
        console.log('üîç Debug Info:');
        console.log('Current URL:', window.location.href);
        console.log('User Agent:', navigator.userAgent);
        console.log('API Key in script:', 'AIzaSyCPhhp2rAt1VTrIzjgagJXZPZ_nc7K_BVo');
    </script>
</body>
</html>
